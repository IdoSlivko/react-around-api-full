(this["webpackJsonparound-react-auth"]=this["webpackJsonparound-react-auth"]||[]).push([[0],{30:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),i=n(19),c=n.n(i),s=n(9),r=(n(30),n(24)),l=n(3),u=n(2),p=n(0);function m(e){return Object(p.jsx)("section",{className:"popup ".concat(e.isOpen?"popup_opened":""),children:Object(p.jsxs)("div",{className:"popup__container",children:[Object(p.jsx)("button",{className:"popup__close-button",type:"button","aria-label":"close modal",onClick:e.isReject?e.onClose:e.onRegisterClose}),Object(p.jsx)("div",{className:"popup__alert-icon popup__alert-icon_".concat(e.isOpen?"confirm":""," popup__alert-icon_").concat(e.isReject?"reject":"")}),Object(p.jsx)("h3",{className:"popup__title popup__title_tooltip",children:e.isReject?"Oops, something went wrong! Please try again.":e.isOpen?"Success! You have now been registered.":""})]})})}function d(e){return Object(p.jsx)("section",{className:"popup popup_".concat(e.name," ").concat(e.isOpen?"popup_opened":""),children:Object(p.jsx)("div",{className:"popup__container",children:Object(p.jsxs)("form",{className:"popup__form popup__".concat(e.name,"-form"),name:e.name,onSubmit:e.onSubmit,children:[Object(p.jsx)("button",{className:"popup__close-button popup__close-".concat(e.name),type:"button","aria-label":"close modal",onClick:e.onClose}),Object(p.jsx)("h3",{className:"popup__title popup__".concat(e.name,"-title"),children:e.title}),e.children,Object(p.jsx)("button",{className:"popup__submit popup__".concat(e.name,"-submit"),type:"submit",children:e.submitText})]})})})}var j=o.a.createContext();function h(e){var t=o.a.useContext(j),n=o.a.useState(""),a=Object(l.a)(n,2),i=a[0],c=a[1],s=o.a.useState(""),r=Object(l.a)(s,2),u=r[0],m=r[1];return o.a.useEffect((function(){c(t.name),m(t.about)}),[t,e.isOpen]),Object(p.jsxs)(d,{name:"profile",title:"Edit profile",isOpen:e.isOpen,onClose:e.onClose,submitText:"Save",onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:i,about:u})},children:[Object(p.jsx)("input",{id:"fullName-input",className:"popup__input popup__input_content_full-name",type:"text",name:"fullName",placeholder:"Full name",minLength:"2",maxLength:"40",value:i||"",onChange:function(e){c(e.target.value)},required:!0}),Object(p.jsx)("span",{id:"fullName-input-error",className:"popup__input-error-msg"}),Object(p.jsx)("input",{id:"about-input",className:"popup__input popup__input_content_about",type:"text",name:"about",placeholder:"About",minLength:"2",maxLength:"200",value:u||"",onChange:function(e){m(e.target.value)},required:!0}),Object(p.jsx)("span",{id:"about-input-error",className:"popup__input-error-msg"})]})}function b(e){var t=o.a.useRef();return o.a.useEffect((function(){t.current.value=""}),[e.isOpen]),Object(p.jsxs)(d,{name:"edit-profile-image",title:"Change profile picture",isOpen:e.isOpen,onClose:e.onClose,submitText:"Save",onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar({avatarLink:t.current.value})},children:[Object(p.jsx)("input",{id:"avatarLink-input",className:"popup__input popup__input_content_edit-profile-image-link",type:"url",name:"avatarLink",placeholder:"Image link",ref:t,required:!0}),Object(p.jsx)("span",{id:"avatarLink-input-error",className:"popup__input-error-msg"})]})}function f(e){var t=o.a.useState(""),n=Object(l.a)(t,2),a=n[0],i=n[1],c=o.a.useState(""),s=Object(l.a)(c,2),r=s[0],u=s[1];return o.a.useEffect((function(){i(""),u("")}),[e.isOpen]),Object(p.jsxs)(d,{name:"add-image",title:"New place",isOpen:e.isOpen,onClose:e.onClose,submitText:"Create",onSubmit:function(t){t.preventDefault(),e.onAddPlace({title:a,link:r})},children:[Object(p.jsx)("input",{id:"imgTitle-input",className:"popup__input popup__input_content_add-image-title",type:"text",name:"imageTitle",placeholder:"Title",minLength:"1",maxLength:"30",value:a,onChange:function(e){i(e.target.value)},required:!0}),Object(p.jsx)("span",{id:"imgTitle-input-error",className:"popup__input-error-msg"}),Object(p.jsx)("input",{id:"imgLink-input",className:"popup__input popup__input_content_add-image-link",type:"url",name:"imageLink",placeholder:"Image link",value:r,onChange:function(e){u(e.target.value)},required:!0}),Object(p.jsx)("span",{id:"imgLink-input-error",className:"popup__input-error-msg"})]})}function g(e){return Object(p.jsx)("section",{className:"popup popup_large-image ".concat(e.data.name?"popup_opened":""),children:Object(p.jsxs)("figure",{className:"popup__container-large-image",children:[Object(p.jsx)("button",{className:"popup__close-button popup__close-large-image","aria-label":"close image",onClick:e.onClose}),Object(p.jsx)("img",{className:"popup__image",src:e.data.link,alt:"some text"}),Object(p.jsx)("figcaption",{className:"popup__caption",children:e.data.name})]})})}var _="https://api.idoslivko.students.nomoreparties.sbs";function O(e,t,n){if(400===e.status)throw new Error("400 - ".concat(t));if(401===e.status)throw new Error("401 - ".concat(n));if(e.ok)return e.json();throw new Error("400 - ".concat(t))}var x=n(8),k=n(25),v=["children","loggedIn"];function C(e){var t=e.children,n=e.loggedIn,a=Object(k.a)(e,v);return Object(p.jsx)(u.b,Object(x.a)(Object(x.a)({},a),{},{children:n?t:Object(p.jsx)(u.a,{to:"/signin"})}))}var N=n(11);function S(e){return Object(p.jsxs)("header",{className:"header",children:[Object(p.jsx)("div",{className:"logo"}),Object(p.jsxs)("div",{className:"header__container",children:[Object(p.jsx)("div",{className:"header__user-email",children:e.userEmail}),Object(p.jsx)(s.b,{className:"link link_".concat(e.userChangeState),to:e.linkRoute,onClick:e.onClick,children:e.linkText})]})]})}function y(e){return Object(p.jsxs)("section",{className:"auth-page",children:[Object(p.jsx)("h1",{className:"auth-page__title",children:e.title}),Object(p.jsxs)("form",{className:"auth-page__form",name:e.name,onSubmit:e.onSubmit,children:[Object(p.jsx)("input",{className:"auth-page__input",name:"email",type:"email",placeholder:"Email",value:e.emailValue,onChange:e.onChange,required:!0}),Object(p.jsx)("input",{className:"auth-page__input",name:"password",type:"password",placeholder:"Password",value:e.passwordValue,onChange:e.onChange,minLength:"3",required:!0}),Object(p.jsx)("button",{className:"auth-page__submit",type:"submit",children:e.submitText})]}),Object(p.jsx)(s.b,{className:"link",to:e.linkRoute,children:e.linkText})]})}function T(e){var t=o.a.useState({email:"",password:""}),n=Object(l.a)(t,2),a=n[0],i=n[1];return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(S,{linkText:"Log in",linkRoute:"/signin",userChangeState:"login"}),Object(p.jsx)(y,{title:"Sign up",name:"register-form",submitText:"Sign up",onSubmit:function(t){t.preventDefault(),e.onRegister(a)},emailValue:a.email,passwordValue:a.password,onChange:function(e){var t=e.target,n=t.name,o=t.value;i(Object(x.a)(Object(x.a)({},a),{},Object(N.a)({},n,o)))},linkText:"Already a member? Log in here!",linkRoute:"/signin"})]})}function w(e){var t=o.a.useState({email:"",password:""}),n=Object(l.a)(t,2),a=n[0],i=n[1];return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(S,{linkText:"Sign up",linkRoute:"/signup",userChangeState:"login"}),Object(p.jsx)(y,{title:"Log in",name:"login-form",submitText:"Log in",onSubmit:function(t){t.preventDefault(),a.email&&a.password&&(i(a),e.onLogin(a))},emailValue:a.email,passwordValue:a.password,onChange:function(e){var t=e.target,n=t.name,o=t.value;i(Object(x.a)(Object(x.a)({},a),{},Object(N.a)({},n,o)))},linkText:"Not a member yet? Sign up here!",linkRoute:"/signup"})]})}var I=o.a.createContext();function E(e){var t=o.a.useContext(j),n=e.data.owner._id===t._id||e.data.owner===t._id,a=e.data.likes.some((function(e){return e===t._id})),i="elements__delete-button ".concat(n?"elements__delete-button_active":""),c="elements__like-button ".concat(a?"elements__like-button_active":"");return Object(p.jsxs)("article",{className:"elements__item",children:[Object(p.jsx)("button",{className:i,type:"button",title:"Delete image","aria-label":"delete image",onClick:function(){e.onCardDelete(e.data)}}),Object(p.jsx)("img",{className:"elements__image",src:e.data.link,alt:e.data.name,onClick:function(){e.onCardClick(e.data)}}),Object(p.jsxs)("div",{className:"elements__description",children:[Object(p.jsx)("h3",{className:"elements__title",children:e.data.name}),Object(p.jsxs)("div",{className:"elements__like-section",children:[Object(p.jsx)("button",{className:c,type:"button","aria-label":"like button",onClick:function(){e.onCardLike(e.data)}}),Object(p.jsx)("div",{className:"elements__like-counter",children:e.data.likes.length})]})]})]})}function L(e){var t=o.a.useContext(j),n=o.a.useContext(I);function a(t){e.onCardLike(t)}function i(t){e.onCardDelete(t)}return Object(p.jsxs)("main",{className:"content",children:[Object(p.jsxs)("section",{className:"profile",children:[Object(p.jsxs)("div",{className:"profile__info",children:[Object(p.jsx)("button",{className:"profile__edit-image",title:"Edit profile image",onClick:e.onEditAvatarClick}),Object(p.jsx)("div",{className:"profile__image-container",children:Object(p.jsx)("img",{className:"profile__image",alt:"User profile pic",src:t.avatar})}),Object(p.jsxs)("div",{className:"profile__main-text",children:[Object(p.jsxs)("div",{className:"profile__text",children:[Object(p.jsx)("h1",{className:"profile__name",children:t.name}),Object(p.jsx)("button",{className:"profile__edit-profile",title:"Edit profile","aria-label":"edit profile",onClick:e.onEditProfileClick})]}),Object(p.jsx)("p",{className:"profile__occupation",children:t.about})]})]}),Object(p.jsx)("button",{className:"profile__add-photo",title:"Add photo","aria-label":"add photo",onClick:e.onAddPlaceClick})]}),Object(p.jsx)("section",{className:"elements",children:n.map((function(t){return Object(p.jsx)(E,{data:t,onCardClick:e.onCardClick,onCardLike:a,onCardDelete:i},t._id)}))})]})}function A(){return Object(p.jsx)("footer",{className:"footer",children:Object(p.jsx)("p",{className:"footer__copyright",children:"\xa9 2021 Around The U.S."})})}var P=n(22),R=n(23),U=new(function(){function e(t){var n=t.baseUrl,a=t.headers;Object(P.a)(this,e),this._baseUrl=n,this._headers=a}return Object(R.a)(e,[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject(e.statusText)}},{key:"getServerImages",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards"),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){return t._checkResponse(e)}))}},{key:"changeLikeImageStatus",value:function(e,t,n){var a=this;return t?fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(n)},method:"PUT"}).then((function(e){return a._checkResponse(e)})):fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(n)},method:"DELETE"}).then((function(e){return a._checkResponse(e)}))}},{key:"setProfileInfo",value:function(e,t,n){var a=this;return fetch("".concat(this._baseUrl,"/users/me"),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(n)},method:"PATCH",body:JSON.stringify({name:e,about:t})}).then((function(e){return a._checkResponse(e)}))}},{key:"setProfileImage",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"PATCH",body:JSON.stringify({avatar:e})}).then((function(e){return n._checkResponse(e)}))}},{key:"addNewImage",value:function(e,t,n){var a=this;return fetch("".concat(this._baseUrl,"/cards"),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(n)},method:"POST",body:JSON.stringify({name:e,link:t})}).then((function(e){return a._checkResponse(e)}))}},{key:"deleteImage",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"DELETE"}).then((function(e){return n._checkResponse(e)}))}}]),e}())({baseUrl:"https://api.idoslivko.students.nomoreparties.sbs"});function D(){var e=o.a.useState({}),t=Object(l.a)(e,2),n=t[0],a=t[1],i=o.a.useState([]),c=Object(l.a)(i,2),s=c[0],d=c[1],x=o.a.useState({name:"",link:""}),k=Object(l.a)(x,2),v=k[0],N=k[1],y=o.a.useState(localStorage.getItem("token")),E=Object(l.a)(y,2),P=E[0],R=E[1],D=o.a.useState(!1),B=Object(l.a)(D,2),z=B[0],q=B[1],F=o.a.useState(!1),J=Object(l.a)(F,2),V=J[0],H=J[1],G=o.a.useState(!1),M=Object(l.a)(G,2),Y=M[0],K=M[1],Q=o.a.useState(!1),W=Object(l.a)(Q,2),X=W[0],Z=W[1],$=o.a.useState(!1),ee=Object(l.a)($,2),te=ee[0],ne=ee[1],ae=o.a.useState(!1),oe=Object(l.a)(ae,2),ie=oe[0],ce=oe[1],se=Object(u.g)();function re(){q(!1),H(!1),K(!1),N({name:"",link:""}),Z(!1),ne(!1)}return o.a.useEffect((function(){var e=localStorage.getItem("token");U.getServerImages(e).then((function(e){d(e.data)})).catch((function(e){return console.log("Error from getServerImages:",e)}))}),[]),o.a.useEffect((function(){var e=localStorage.getItem("token");e&&function(e){return fetch("".concat(_,"/users/me"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){return O(e,"Token not provided or provided in the wrong format","The provided token is invalid")}))}(e).then((function(e){ce(!0),a(e.owner),se.push("/users/me")})).catch((function(e){return console.log(e)}))}),[se]),Object(p.jsx)("div",{className:"page",children:Object(p.jsx)(j.Provider,{value:n,children:Object(p.jsxs)(I.Provider,{value:s,children:[Object(p.jsxs)(u.d,{children:[Object(p.jsx)(u.b,{path:"/signup",children:Object(p.jsx)(T,{onRegister:function(e){(function(e){var t=e.email,n=e.password;return fetch("".concat(_,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})}).then((function(e){return O(e,"one of the fields was filled in incorrectly")}))})(e).then((function(e){Z(!0)})).catch((function(e){Z(!0),ne(!0),console.log(e)}))}})}),Object(p.jsx)(u.b,{path:"/signin",children:Object(p.jsx)(w,{onLogin:function(e){(function(e){var t=e.email,n=e.password;return fetch("".concat(_,"/signin"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})}).then((function(e){return O(e,"one or more of the fields were not provided","the user with the specified email not found")}))})(e).then((function(e){if(e.token)return localStorage.setItem("token",e.token),R(localStorage.getItem("token")),ce(!0),a(e.owner),U.getServerImages(localStorage.getItem("token")).then((function(e){d(e.data)})).catch((function(e){return console.log("Error from getServerImages:",e)})),se.push("/users/me"),e})).catch((function(e){Z(!0),ne(!0),console.log(e)}))}})}),Object(p.jsxs)(C,{path:"/users/me",loggedIn:ie,children:[Object(p.jsx)(S,{userEmail:n.email,linkText:"Log out",linkRoute:"/signin",userChangeState:"logout",onClick:function(){localStorage.removeItem("token"),a({}),se.push("/login")}}),Object(p.jsx)(L,{onEditAvatarClick:function(){q(!0)},onEditProfileClick:function(){H(!0)},onAddPlaceClick:function(){K(!0)},onCardClick:function(e){N({name:e.name,link:e.link,likes:e.likes.length})},onCardLike:function(e){var t=e.likes.some((function(e){return e===n._id}));U.changeLikeImageStatus(e._id,!t,P).then((function(t){d((function(n){return n.map((function(n){return n._id===e._id?t.data:n}))}))})).catch((function(e){return console.log("Error from changeLikeImageStatus:",e)}))},onCardDelete:function(e){U.deleteImage(e._id,P).then((function(t){console.log("but most of all Samy is my hero..."),d(s.filter((function(t){return t._id!==e._id})))})).catch((function(e){return console.log("Error from deleteImage:",e)}))}}),Object(p.jsx)(A,{})]}),Object(p.jsx)(u.b,{path:"/",children:ie?Object(p.jsx)(u.a,{to:"/users/me"}):Object(p.jsx)(u.a,{to:"/signin"})})]}),Object(p.jsx)(m,{isOpen:X,isReject:te,onClose:re,onRegisterClose:function(){Z(!1),setTimeout((function(){se.push("/signin")}),50)}}),Object(p.jsx)(b,{isOpen:z,onClose:re,onUpdateAvatar:function(e){var t=e.avatarLink;U.setProfileImage(t,P).then((function(e){a(e.owner),re()})).catch((function(e){return console.log("Error from setProfileImage:",e)}))}}),Object(p.jsx)(h,{isOpen:V,onClose:re,onUpdateUser:function(e){var t=e.name,n=e.about;U.setProfileInfo(t,n,P).then((function(e){a(e.owner),re()})).catch((function(e){return console.log("Error from setProfileInfo:",e)}))}}),Object(p.jsx)(f,{isOpen:Y,onClose:re,onAddPlace:function(e){var t=e.title,n=e.link;U.addNewImage(t,n,P).then((function(e){d([e.data].concat(Object(r.a)(s))),re()})).catch((function(e){return console.log("Error from addNewImage:",e)}))}}),Object(p.jsx)(g,{data:v,onClose:re})]})})})}var B=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,38)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),o(e),i(e),c(e)}))};c.a.render(Object(p.jsx)(o.a.StrictMode,{children:Object(p.jsx)(s.a,{children:Object(p.jsx)(D,{})})}),document.getElementById("root")),B()}},[[37,1,2]]]);
//# sourceMappingURL=main.26126575.chunk.js.map